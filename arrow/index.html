<html>
    <head>
        <meta charset="utf-8"/>
        <!-- <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/> -->
        <title>2048</title>
        <style>
            body {
                margin: 0;
                font-family: Verdana;
                color: #505050;
                overflow: hidden;
            }

                #main {
                    position: fixed;
                    top: 10vh;
                    left: calc(50% - 40vh);
                    width: 80vh;
                    height: 80vh;
                    background-color: #e6e6e6;
                    border-radius: 2vh;
                    box-sizing: border-box;
                    padding: 2vh;
                    user-select: none;
                }

                body[mobile="true"] #main {
                    top: calc(50% - 40vw);
                    left: 10vw;
                    width: 80vw;
                    height: 80vw;
                    border-radius: 2vw;
                    padding: 2vw;
                }

                    .num {
                        position: absolute;
                        z-index: 2;
                        width: 17.5vh;
                        height: 17.5vh;
                        background-color: #ffffff;
                        background-image: url('arrow.png');
                        background-repeat: no-repeat;
                        background-size: cover;
                        border-radius: 1.2vh;
                        line-height: 17.5vh;
                        text-align: center;
                        transition: linear .3s top, linear .3s left, linear .3s background-color;
                    }

                        body[mobile="true"] .num {
                            width: 17.5vw;
                            height: 17.5vw;
                            border-radius: 1.2vw;
                            line-height: 17.5vw;
                        }

                        .num[y="1"] {
                            top: 2vh;
                        }
                        .num[y="2"] {
                            top: 21.5vh;
                        }
                        .num[y="3"] {
                            top: 41vh;
                        }
                        .num[y="4"] {
                            top: 60.5vh;
                        }

                        body[mobile="true"] .num[y="1"] {
                            top: 2vw;
                        }
                        body[mobile="true"] .num[y="2"] {
                            top: 21.5vw;
                        }
                        body[mobile="true"] .num[y="3"] {
                            top: 41vw;
                        }
                        body[mobile="true"] .num[y="4"] {
                            top: 60.5vw;
                        }

                        .num[x="1"] {
                            left: 2vh;
                        }
                        .num[x="2"] {
                            left: 21.5vh;
                        }
                        .num[x="3"] {
                            left: 41vh;
                        }
                        .num[x="4"] {
                            left: 60.5vh;
                        }

                        body[mobile="true"] .num[x="1"] {
                            left: 2vw;
                        }
                        body[mobile="true"] .num[x="2"] {
                            left: 21.5vw;
                        }
                        body[mobile="true"] .num[x="3"] {
                            left: 41vw;
                        }
                        body[mobile="true"] .num[x="4"] {
                            left: 60.5vw;
                        }

                        .num[id="cursor"] {
                            z-index: 1000;
                            background-image: none;
                            background-color: #53c0ef;
                        }

                            .num[id="cursor"][active="false"] {
                                background-color: #ffffff;
                            }

                        .num[val="1"] {
                            transform: rotate(-90deg);
                        }
                        .num[val="3"] {
                            transform: rotate(90deg);
                        }
                        .num[val="4"] {
                            transform: rotate(180deg);
                        }

                        .num[val="-1"] {
                            background-image: none;
                        }
        </style>
    </head>
    <body>
        <div id="main">
            <div class="num" x="1" y="1"></div>
            <div class="num" x="2" y="1"></div>
            <div class="num" x="3" y="1"></div>
            <div class="num" x="4" y="1"></div>

            <div class="num" x="1" y="2"></div>
            <div class="num" x="2" y="2"></div>
            <div class="num" x="3" y="2"></div>
            <div class="num" x="4" y="2"></div>

            <div class="num" x="1" y="3"></div>
            <div class="num" x="2" y="3"></div>
            <div class="num" x="3" y="3"></div>
            <div class="num" x="4" y="3"></div>

            <div class="num" x="1" y="4"></div>
            <div class="num" x="2" y="4"></div>
            <div class="num" x="3" y="4"></div>
            <div class="num" x="4" y="4"></div>
        </div>
    </body>
    <script>
        if (window.innerHeight > window.innerWidth) {
            document.body.setAttribute('mobile', 'true')
        }

        let movesCount = 0

        window.addEventListener('keydown', (e) => {
            let cursor = document.querySelector('#cursor'),
                x = parseInt(cursor.getAttribute('x')),
                y = parseInt(cursor.getAttribute('y')),
                tile = document.querySelector(`[x="${x}"][y="${y}"]`)

            if (e.detail.key) e.key = e.detail.key

            if (movesCount < 24) {
                if (e.key == 'ArrowUp' && y > 1) cursor.setAttribute('y', y - 1)
                if (e.key == 'ArrowDown' && y < 4) cursor.setAttribute('y', y + 1)
                if (e.key == 'ArrowLeft' && x > 1) cursor.setAttribute('x', x - 1)
                if (e.key == 'ArrowRight' && x < 4) cursor.setAttribute('x', x + 1)
                
                if (e.key == 'ArrowUp' && tile.getAttribute('val') == '1') tile.setAttribute('val', '-1')
                if (e.key == 'ArrowDown' && tile.getAttribute('val') == '3') tile.setAttribute('val', '-1')
                if (e.key == 'ArrowLeft' && tile.getAttribute('val') == '4') tile.setAttribute('val', '-1')
                if (e.key == 'ArrowRight' && tile.getAttribute('val') == '2') tile.setAttribute('val', '-1')

                movesCount++
            } else {
                cursor.setAttribute('active', 'false')
            }
        })

        class Arrow {
            constructor (size) {
                this.size = size
            }

            init() {
                try {
                    this.matr = Array(this.size).fill().map(() => Array(this.size).fill(0))
                    for (let x = 0; x < this.size; x++)
                        for (let y = 0; y < this.size; y++)
                            this.matr[x][y] = this.genRand(1, 4)

                    return this.matr
                } catch {
                    return false
                }
            }

            genRand(min, max) {
                if (!max) {
                    max = min
                    min = 0
                }

                try {
                    return Math.floor(Math.random() * (max - min + 1) + min)
                } catch {
                    return false
                }
            }
        }

        let matr = new Arrow(4)
        if (matr.init()) {
            let cursor = document.createElement('div')
            cursor.className = 'num'
            cursor.id = 'cursor'
            const [x, y] = [matr.genRand(1, matr.size), matr.genRand(1, matr.size)]
            cursor.setAttribute('x', x)
            cursor.setAttribute('y', y)
            document.querySelector('#main').appendChild(cursor)
            matr.matr[x - 1][y - 1] = -1

            for (let x = 0; x < matr.size; x++)
                for (let y = 0; y < matr.size; y++)
                    document.querySelector(`[y="${y + 1}"][x="${x + 1}"]`).setAttribute('val', matr.matr[x][y])
        }

        let x, y
        document.querySelector('#main').addEventListener('touchstart', (e) => {
            x = e.changedTouches[0].pageX
            y = e.changedTouches[0].pageY
        })
        document.querySelector('#main').addEventListener('touchend', (e) => {
            let _x = e.changedTouches[0].pageX,
                _y = e.changedTouches[0].pageY,
                event

            if (x > _x && 0.8 < y/_y && y/_y < 1.2) event = new CustomEvent('keydown', {detail: {'key': 'ArrowLeft'}})
            else if (x < _x && 0.8 < y/_y && y/_y < 1.2) event = new CustomEvent('keydown', {detail: {'key': 'ArrowRight'}})
            else if (y > _y && 0.8 < x/_x && x/_x < 1.2) event = new CustomEvent('keydown', {detail: {'key': 'ArrowUp'}})
            else if (y < _y && 0.8 < x/_x && x/_x < 1.2) event = new CustomEvent('keydown', {detail: {'key': 'ArrowDown'}})
            
            if (event) window.dispatchEvent(event)
        })
    </script>
</html>